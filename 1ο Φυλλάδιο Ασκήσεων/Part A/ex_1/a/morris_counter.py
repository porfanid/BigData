# ONOMA: Ανδρεόπουλος Ευστάθιος 	ΑΜ: 4630    EMAIL: cs04630@uoi.gr
# ONOMA: Ορφανίδης Παύλος 			ΑΜ: 4134    EMAIL: cs04134@uoi.gr

# Εισαγωγή απαραίτητων βιβλιοθηκών
import numpy as np
import matplotlib.pyplot as plt
import random

# Υλοποίηση του αλγορίθμου Morris Counter
# Ο στόχος είναι να μετρήσουμε κατά προσέγγιση τον αριθμό των στοιχείων,
# χρησιμοποιώντας πολύ λιγότερη μνήμη σε σχέση με έναν κλασικό μετρητή.

class MorrisCounter:
    def __init__(self):
        # Αρχικοποιούμε τον εσωτερικό μετρητή C στο 0
        # Η τιμή αυτή δεν είναι η πραγματική μέτρηση, αλλά θα τη χρησιμοποιήσουμε για να την προσεγγίσουμε
        self.C = 0

    def insert(self):
        # Σε κάθε εισαγωγή στοιχείου, αποφασίζουμε τυχαία αν θα αυξήσουμε τον C
        # Όσο μεγαλώνει το C, τόσο μικρότερη είναι η πιθανότητα να αυξηθεί
        # Αυτό εξασφαλίζει ότι η αύξηση γίνεται εκθετικά πιο "ακριβή" και μνήμη-φιλική
        if random.random() < 1 / (2 ** self.C):
            self.C += 1  # Αυξάνουμε τον μετρητή

    def query(self):
        # Επιστρέφουμε την εκτίμηση του πλήθους των στοιχείων
        # Σύμφωνα με τον Morris, η εκτίμηση είναι: 2^C - 1
        return 2 ** self.C - 1

# Συνάρτηση για τη δοκιμή του Morris Counter
# Εισάγουμε n στοιχεία και καταγράφουμε την εκτίμηση του μετρητή μετά από κάθε ένα
def morris_test(n=1000000):
    # Δημιουργία του μετρητή
    counter = MorrisCounter()
    
    # Λίστα για αποθήκευση όλων των εκτιμήσεων μετά από κάθε εισαγωγή
    estimates = []

    # Εισαγωγή n στοιχείων στον μετρητή
    for i in range(1, n + 1):
        counter.insert()  # Εισάγουμε ένα στοιχείο
        estimates.append(counter.query())  # Καταγράφουμε την εκτίμηση

    # Επιστρέφουμε τη λίστα με όλες τις εκτιμήσεις
    return estimates

# Ορισμός seed για αναπαραγωγιμότητα των αποτελεσμάτων (ώστε η τυχαιότητα να είναι σταθερή)
random.seed(42)

# Καθορισμός πλήθους εισαγωγών
n = 1000000  # 1 εκατομμύριο εισαγωγές

# Εκτέλεση της δοκιμής και αποθήκευση των εκτιμήσεων
estimates = morris_test(n)

# Δημιουργία γραφήματος για την απεικόνιση των εκτιμήσεων
plt.figure(figsize=(10, 6))  # Ορισμός μεγέθους γραφήματος

# Σχεδίαση των εκτιμήσεων του Morris Counter (μπλε γραμμή)
plt.plot(range(1, n + 1), estimates, color='blue', label='Morris Counter Estimate')

# Σχεδίαση της πραγματικής τιμής (κόκκινη διακεκομμένη γραμμή)
plt.plot(range(1, n + 1), range(1, n + 1), color='red', linestyle='--', label='Actual Count')

# Ορισμός λογαριθμικής κλίμακας στους άξονες x και y για καλύτερη ορατότητα σε μεγάλες τιμές
plt.xscale('log')
plt.yscale('log')

# Προσθήκη τίτλων και ετικετών στους άξονες
plt.xlabel('Πραγματικός Αριθμός Εισαγωγών (n)')
plt.ylabel('Εκτίμηση μετρητή')
plt.title('Εκτίμηση του Morris Counter σε σχέση με τον πραγματικό αριθμό')

# Προσθήκη υπομνήματος και πλέγματος
plt.legend()
plt.grid(True)

# Αποθήκευση του γραφήματος ως εικόνα (PNG)
plt.savefig('morris_counter_1a.png')

# Κλείσιμο του παραθύρου σχεδίασης
plt.close()
